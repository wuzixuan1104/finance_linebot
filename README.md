# æ­¡è¿Žä¾†åˆ° Maple
ðŸ é£›èµ·ä¾† ðŸ é£›éŽä¾†

## èªªæ˜Ž
* é€™æ˜¯ä¸€å¥— [OA Wu](https://www.ioa.tw/) æ‰€è£½ä½œçš„å€‹äºº [PHP](http://php.net/) æ¡†æž¶ï¼  
* ä¸»åŠŸèƒ½æ˜¯å¿«é€Ÿæž¶æ§‹å¾Œå°ã€Migration ç®¡ç†ã€ä½¿ç”¨ Active Record å¼çš„ Modelï¼ŒåŠ å…¥ [apiDoc](http://apidocjs.com/)ã€ä½¿ç”¨ [Deployer](https://deploye4.r.org/) å¿«é€Ÿéƒ¨ç½²è‡³ä¼ºæœå™¨ ç­‰åŠŸèƒ½ã€‚  
* æ­¤æ¡†æž¶éœ€è¦æ­é… `maple` æŒ‡ä»¤æ“ä½œï¼Œä¾†é€²è¡Œç›¸é—œåŠŸèƒ½ï¼Œæ–‡ä»¶ä¸­æœƒèªªæ˜Žè©²å¦‚ä½•ä½¿ç”¨ã€‚
* åˆå§‹æž¶æ§‹åƒè€ƒ [CodeIgniter](https://www.codeigniter.com/) èˆ‡ [OACI](https://github.com/comdan66/oaci)ã€‚
* æ­¤æ¡†æž¶ä¸»è¦æ”¯æ´ PHP 5.6ï¼ˆåŒ…å«ï¼‰ä»¥ä¸Šã€‚  

## Maple æŒ‡ä»¤
ä¸‹è¼‰ Maple pharï¼Œè«‹æ‰“é–‹çµ‚ç«¯æ©Ÿï¼Œä¾åºåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å®Œå¾Œï¼Œé‡æ–°é–‹å•Ÿçµ‚ç«¯æ©Ÿå³å¯ã€‚

* ä¸‹è¼‰ `curl -LO https://comdan66.github.io/Maple/maple`
* æ¬ç§» `mv maple /usr/local/bin/maple`
* æ¬Šé™ `chmod +x /usr/local/bin/maple`

## åˆå§‹åŒ–å°ˆæ¡ˆ
å°ˆæ¡ˆæœ€åˆé–‹å§‹é€šå¸¸éœ€è¦ä¸€äº›çµæ§‹ç›®éŒ„çš„å»ºç½®ï¼Œä¾‹å¦‚ cacheã€log ç­‰ç›®éŒ„ï¼Œæ‰€ä»¥éœ€è¦åŸ·è¡Œåˆå§‹å‹•ä½œï¼Œåœ¨ Maple æ¡†æž¶ä¸‹åªéœ€è¦æ‰“é–‹çµ‚ç«¯æ©Ÿï¼ŒåŸ·è¡ŒæŒ‡ä»¤ `maple init` å¾Œï¼Œä¾æ“šæ‰€éœ€å³å¯å»ºç«‹åˆå§‹æ‰€éœ€çš„ç›®éŒ„çµæ§‹ã€‚


## éƒ¨ç½²å°ˆæ¡ˆ
å°ˆæ¡ˆéƒ¨ç½²æ›´æ–°è‡³ä¼ºæœå™¨å‰è«‹å…ˆç¢ºèªä»¥ä¸‹å¹¾é …æ­¥é©Ÿï¼š

1. è«‹è‡³ä¼ºæœå™¨è¨­å®šå°ˆæ¡ˆï¼Œå°‡å°ˆæ¡ˆå»ºç½®èµ·ä¾†ï¼Œç¢ºèªå°ˆæ¡ˆå¯ä»¥æ­£å¸¸ä½¿ç”¨ `git pull` èˆ‡ `maple` æŒ‡ä»¤ï¼Œä»¥åŠåˆå§‹ä¼ºæœå™¨çš„å°ˆæ¡ˆæž¶æ§‹ã€‚ 

2. å› ç‚ºéƒ¨ç½²éŽç¨‹ä¸­æ˜¯ä½¿ç”¨ [SSH](https://zh.wikipedia.org/wiki/Secure_Shell) æ–¹å¼é€£ç·šï¼Œæ‰€ä»¥è«‹æª¢æŸ¥æœ¬åœ°ç«¯æ˜¯å¦å¯ä»¥ä½¿ç”¨å…¬é‘°çš„æ–¹å¼é€£ç·šè‡³ä¼ºæœå™¨ï¼Œè‹¥ä¸æ˜¯è«‹å°‡æœ¬åœ°ç«¯æ©Ÿå™¨çš„å…¬é‘°æ–°å¢žè‡³ä¼ºæœå™¨ `~/.ssh/authorized_keys` æ˜¯å¦æœ‰è¨­å®šéƒ¨ç½²çš„æœ¬åœ°ç«¯æ©Ÿå™¨çš„å…¬é‘°ã€‚

3. è«‹å…ˆå®‰è£éƒ¨ç½²å·¥å…· [Deployer](https://deployer.org/)ï¼Œå¯ä»¥åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å®‰è£ï¼š
	* `curl -LO https://deployer.org/deployer.phar`
	* `mv deployer.phar /usr/local/bin/dep`
	* `chmod +x /usr/local/bin/dep`

4. è«‹åœ¨å°ˆæ¡ˆä¸‹è¨­å®š `deploy.php` çš„ configï¼Œå¯ä»¥ä¾æ“šåˆå§‹æ™‚çš„ç’°å¢ƒæ–°å¢žè‡³ä¸åŒçš„ config ç›®éŒ„ã€‚
> èˆ‰ä¾‹ï¼Œè‹¥æ˜¯ç’°å¢ƒç‚º `development`ï¼Œå°±è¤‡è£½ `app/config/deploy.php` è‡³ `app/config/development/deploy.php` ä¸¦ä¿®æ”¹å…§å®¹ã€‚

ç¢ºèªä»¥ä¸Šæ­¥é©Ÿå¾Œï¼Œå³å¯ä½¿ç”¨ Maple æŒ‡ä»¤éƒ¨ç½²ï¼Œåœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹æ‰“é–‹çµ‚ç«¯æ©Ÿï¼ŒåŸ·è¡ŒæŒ‡ä»¤ `maple deploy` å¾Œï¼Œé¸æ“‡éƒ¨ç½²çš„é¡žåž‹å¾Œå³å¯é–‹å§‹éƒ¨ç½²ã€‚

## æ–°å¢ž Migration
åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹æ‰“é–‹çµ‚ç«¯æ©Ÿï¼ŒåŸ·è¡ŒæŒ‡ä»¤ `maple create migration` å³å¯ã€‚

## æ–°å¢ž Model
åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹æ‰“é–‹çµ‚ç«¯æ©Ÿï¼ŒåŸ·è¡ŒæŒ‡ä»¤ `maple create model` å³å¯ã€‚

## åŸ·è¡Œ Migration
åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹æ‰“é–‹çµ‚ç«¯æ©Ÿï¼ŒåŸ·è¡ŒæŒ‡ä»¤ `maple migration` å³å¯ã€‚

> æ›´æ–°è‡³æœ€æ–°ç‰ˆå¯ä»¥ä¸‹æŒ‡ä»¤ `maple migration new`ã€‚  
> æ›´æ–°è‡³æœ€åˆç‰ˆ(æ­¸é›¶)å¯ä»¥ä¸‹æŒ‡ä»¤ `maple migration ori`ã€‚

## API æ–‡ä»¶
### ç”¢æ–‡ä»¶
1. å…ˆå®‰è£ [Gulp](https://gulpjs.com/)ã€‚
2. è‡³å°ˆæ¡ˆç›®éŒ„ä¸‹çš„ `doc` åŸ·è¡ŒæŒ‡ä»¤ `npm install .` åˆå§‹ gulp å°ˆæ¡ˆã€‚
3. è‡³å°ˆæ¡ˆç›®éŒ„ä¸‹çš„ `doc` åŸ·è¡ŒæŒ‡ä»¤ `gulp api` é–‹å§‹ç”¢ç”Ÿæ–‡ä»¶ã€‚

### éƒ¨ç½²
API æ–‡ä»¶éƒ¨ç½²æ›´æ–°è‡³ S3 å‰è«‹å…ˆç¢ºèªæ˜¯å¦æœ‰è¨­å®š configï¼Œè‹¥æœªè¨­å®šçš„è©±ï¼Œè«‹åœ¨å°ˆæ¡ˆä¸‹è¨­å®š `apiDoc.php` çš„ configï¼Œå¯ä»¥ä¾æ“šåˆå§‹æ™‚çš„ç’°å¢ƒæ–°å¢žè‡³ä¸åŒçš„ config ç›®éŒ„ï¼Œç„¶å¾Œåœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹æ‰“é–‹çµ‚ç«¯æ©Ÿï¼ŒåŸ·è¡ŒæŒ‡ä»¤ `maple apiDoc`ã€‚
> èˆ‰ä¾‹ï¼Œè‹¥æ˜¯ç’°å¢ƒç‚º `development`ï¼Œå°±è¤‡è£½ `app/config/apiDoc.php ` è‡³ `app/config/development/apiDoc.php` ä¸¦ä¿®æ”¹å…§å®¹ã€‚
